<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="欢迎关注 “攻城狮Gala”公/ 众 /号 ，每天一起学习，努力成为Web3全栈 这是另一台NAS，我把专用设备换成了通用设备，可组合性提高不少，同时"><meta name=keywords content="DevOps,DevOps,NAS,NUC12,linux,趣玩,You"><title>NAS折腾记2</title><link rel=canonical href=https://blog.galacoding.fun/blog/devops/nas%E6%8A%98%E8%85%BE%E8%AE%B02/><link rel=stylesheet href=/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="NAS折腾记2"><meta property="og:description" content="欢迎关注 “攻城狮Gala”公/ 众 /号 ，每天一起学习，努力成为Web3全栈 这是另一台NAS，我把专用设备换成了通用设备，可组合性提高不少，同时"><meta property="og:url" content="https://blog.galacoding.fun/blog/devops/nas%E6%8A%98%E8%85%BE%E8%AE%B02/"><meta property="og:site_name" content="攻城狮Gala"><meta property="og:type" content="article"><meta property="article:section" content="Blog"><meta property="article:tag" content="DevOps"><meta property="article:tag" content="NAS"><meta property="article:tag" content="NUC12"><meta property="article:tag" content="linux"><meta property="article:tag" content="趣玩"><meta property="article:tag" content="You"><meta property="article:published_time" content="2023-06-12T21:18:45+08:00"><meta property="article:modified_time" content="2023-06-12T21:18:45+08:00"><meta property="og:image" content="https://blog.galacoding.fun/assets/jainath-ponnala-9wWX_jwDHeM-unsplash.jpg"><meta name=twitter:title content="NAS折腾记2"><meta name=twitter:description content="欢迎关注 “攻城狮Gala”公/ 众 /号 ，每天一起学习，努力成为Web3全栈 这是另一台NAS，我把专用设备换成了通用设备，可组合性提高不少，同时"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.galacoding.fun/assets/jainath-ponnala-9wWX_jwDHeM-unsplash.jpg"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/site/avatar.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>🐰</span></figure><div class=site-meta><h1 class=site-name><a href=/>攻城狮Gala</a></h1><h2 class=site-description>Learning & Researching & Diving</h2></div></header><ol class=social-menu><li><a href=https://github.com/GalaIO target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=/index.xml target=_blank title=Rss rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://twitter.com/galaio_io target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#背景>背景</a></li><li><a href=#硬件>硬件</a><ol><li><a href=#主机>主机</a><ol><li><a href=#bios设置>Bios设置</a></li><li><a href=#系统>系统</a></li><li><a href=#扩展vg存储>扩展vg存储</a></li><li><a href=#安装25寸硬盘>安装2.5寸硬盘</a></li></ol></li><li><a href=#路由器>路由器</a><ol><li><a href=#设置无线ap>设置无线AP</a></li><li><a href=#绑定ip地址>绑定IP地址</a></li></ol></li><li><a href=#硬盘柜>硬盘柜</a><ol><li><a href=#挂载新盘>挂载新盘</a></li></ol></li></ol></li><li><a href=#服务端软件>服务端软件</a><ol><li><a href=#git>Git</a></li><li><a href=#wget>wget</a></li><li><a href=#nginx>Nginx</a></li><li><a href=#aria2>aria2</a><ol><li><a href=#安装>安装</a></li><li><a href=#配置>配置</a></li><li><a href=#webui>WebUI</a></li></ol></li><li><a href=#samba>Samba</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/blog/devops/nas%E6%8A%98%E8%85%BE%E8%AE%B02/><img src=/assets/jainath-ponnala-9wWX_jwDHeM-unsplash.jpg loading=lazy alt="Featured image of post NAS折腾记2"></a></div><div class=article-details><header class=article-category><a href=/categories/devops/ style=background-color:#5ba585;color:#111f2c>DevOps</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/blog/devops/nas%E6%8A%98%E8%85%BE%E8%AE%B02/>NAS折腾记2</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jun 12, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 16 分钟</time></div></footer></div></header><section class=article-content><p>欢迎关注 <strong>“攻城狮Gala”公/ 众 /号</strong> ，每天一起学习，努力成为Web3全栈</p><p>这是另一台NAS，我把专用设备换成了通用设备，可组合性提高不少，同时性能提升巨大～</p><h2 id=背景>背景</h2><p>终于又要折腾NAS了，上一次折腾还是上一次。。参考<a class=link href=/blog/devops/nas%E6%8A%98%E8%85%BE%E8%AE%B0/>NAS折腾记</a>。这一次的主要原因是购买的云服务器性能不足，比如跑AutoGPT？之前的NAS性能也一般，主要是型号太老，想继续升级太难。</p><p>正好在网上看到有人转卖自己的NUC11，我检索了下，NUC的mini主机系列非常适合做NAS，它设计出来会考虑用在工业制造领域，支持<code>7*24</code>小时运行，而且性能非常可观。</p><h2 id=硬件>硬件</h2><p><img src=/assets/Pasted%20image%2020230613215248.png loading=lazy alt="Pasted image 20230613215248.png"></p><h3 id=主机>主机</h3><p>经过对比决定购买<a class=link href=https://www.intel.cn/content/www/cn/zh/products/sku/121626/intel-nuc-12-pro-kit-nuc12wshi5/ordering.html target=_blank rel=noopener>NUC12WSHi5</a>，12核16线程，配置丰富，短时间内足够用。</p><ul><li>内存：金士顿 (Kingston) 32GB DDR4 3200 笔记本内存条；</li><li>硬盘：西部数据（Western Digital）2TB SSD固态硬盘 M.2接口（NVMe协议），注意插好，避免主机无法识别；</li></ul><p><img src=/assets/Pasted%20image%2020230614221613.png loading=lazy alt="Pasted image 20230614221613.png"></p><h4 id=bios设置>Bios设置</h4><p>主要设置：</p><ol><li>关闭WiFi和蓝牙功能，不用避免耗电；</li><li>设置开机自启动，设置<code>After Power Failure</code>为<code>Last State</code>，也就是说断电后再上电如果断电前开机就直接开机，否则依然关机，也可以设置<code>Power On</code>始终保持上电开机；</li></ol><h4 id=系统>系统</h4><p>无脑ubuntu，有人可能会问怎么不用群晖，因为我主要当服务器使用，顺便搭建一些NAS软件提供存储服务。安装最新版本<a class=link href=https://ubuntu.com/download/server target=_blank rel=noopener>Ubuntu Server 23.04</a>。</p><p>一些参考资料：</p><ul><li><a class=link href=/assets/Ubuntu.Server.CLI.pro.tips.19.04.22.pdf>Ubuntu.Server.CLI.pro.tips.19.04.22.pdf</a></li><li><a class=link href=/assets/ubuntu-server-guide-2023-06-11.pdf>ubuntu-server-guide-2023-06-11.pdf</a></li></ul><h4 id=扩展vg存储>扩展vg存储</h4><p>默认安装情况下，LVM只会占用足够的空间，可以使用<code>lvextend</code>占用所有空间。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看磁盘空间使用情况</span>
</span></span><span class=line><span class=cl>$ df -h
</span></span><span class=line><span class=cl><span class=c1># 扩展所有vg</span>
</span></span><span class=line><span class=cl>$ sudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv
</span></span><span class=line><span class=cl>$ sudo resize2fs /dev/ubuntu-vg/ubuntu-lv
</span></span></code></pre></td></tr></table></div></div><h4 id=安装25寸硬盘>安装2.5寸硬盘</h4><p>如何安装2.5寸硬盘，参考如下，注意是安装在NUC拆下的背板，更多<a class=link href=https://manuals.plus/zh-CN/intel/nuc-12-pro-kit-manual target=_blank rel=noopener>指南参考</a>。</p><p><img src=/assets/Pasted%20image%2020230625195309.png loading=lazy alt="Pasted image 20230625195309.png"></p><h3 id=路由器>路由器</h3><h4 id=设置无线ap>设置无线AP</h4><p>家里的网络有点复杂，首先有一个电信入户的光猫，在客厅有一个无线路由器，在卧室还有一个无线路由器，现在的一个问题是每个无线路由器都会开一个子网相互设备无法访问，虽然都可以访问公网。现在需要把所有无线路由器修改为无线AP，这样就可以共享光猫一个网段。</p><p>假设被共享网段的路由器是主路由器，对于一般的无线路由器，需要3个步骤成为无线AP：</p><ol><li>关闭路由器DHCP功能；</li><li>在路由器LAN口设置，设置主路由器同网段任意未使用ip；</li><li>连接路由器的LAN口道主路由器的LAN口，也就是当交换机使用了；</li></ol><p><img src=/assets/Pasted%20image%2020230613215344.png loading=lazy alt="Pasted image 20230613215344.png"></p><blockquote><p>Note：小米或者红米路由器有一个有线中继模式，切换后直接变成无线AP。</p></blockquote><p>参考资料：</p><ul><li><a class=link href=https://smb.tp-link.com.cn/service/detail_article_89.html target=_blank rel=noopener>多台路由器如何串联（级联）？</a></li><li><a class=link href="https://resource.tp-link.com.cn/pc/docCenter/showDoc?source=search&amp;id=1655112585159408" target=_blank rel=noopener>如何设置路由器当无线交换机使用</a></li><li><a class=link href=https://www.mi.com/service/miwifi/miwifi2/Repeater target=_blank rel=noopener>小米路由器-有线中继设置</a></li></ul><h4 id=绑定ip地址>绑定IP地址</h4><p>为了避免设备频繁更换IP，可以在路由器侧绑定IP地址分配，同时无需手动更改本机IP。一般DHCP设置页面都可以修改。</p><p><img src=/assets/Pasted%20image%2020230613214956.png loading=lazy alt="Pasted image 20230613214956.png"></p><h3 id=硬盘柜>硬盘柜</h3><p>NUC上的固态始终容量有限无法存储所有数据，之前的NAS还有两个硬盘，经过搜索发现硬盘柜可以解决我的需求～</p><p>硬盘柜选择的 奥睿科(ORICO)硬盘柜多盘位3.5英寸USB3.0 这款，有以下原因：</p><ul><li>有风扇，因为硬盘的温度需要控制一下才能更稳定传输，如果没风扇硬盘会超级烫；</li><li>支持10分钟无操作休眠；</li><li>易安装，支持2.5寸/3.5寸；</li></ul><p><img src=/assets/Pasted%20image%2020230614221151.png loading=lazy alt="Pasted image 20230614221151.png"></p><h4 id=挂载新盘>挂载新盘</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看所有硬盘：</span>
</span></span><span class=line><span class=cl>lsblk -a
</span></span><span class=line><span class=cl><span class=c1># 查看磁盘空间使用情况</span>
</span></span><span class=line><span class=cl>df -h
</span></span><span class=line><span class=cl><span class=c1># 查看未挂载磁盘</span>
</span></span><span class=line><span class=cl>sudo fdisk -l
</span></span><span class=line><span class=cl><span class=c1># 创建目录</span>
</span></span><span class=line><span class=cl>mkdir /data
</span></span><span class=line><span class=cl><span class=c1># 挂载</span>
</span></span><span class=line><span class=cl>sudo mount /dev/sda /data
</span></span><span class=line><span class=cl><span class=c1># 查看设备uuid</span>
</span></span><span class=line><span class=cl>sudo blkid
</span></span><span class=line><span class=cl><span class=c1># 设置开机自动挂载</span>
</span></span><span class=line><span class=cl>sudo vim /etc/fstab
</span></span><span class=line><span class=cl><span class=c1># 按照格式填入挂载盘的uuid和挂载目录, 设置不会失败，超时9s，避免硬盘不再无法开机</span>
</span></span><span class=line><span class=cl><span class=nv>UUID</span><span class=o>=</span><span class=s2>&#34;a22fe25c-304f-4989-9ca6-f2fcdb9342ef&#34;</span> /data ext4 defaults,nofail,x-systemd.device-timeout<span class=o>=</span><span class=m>9</span> <span class=m>0</span> <span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><p>最终效果，<strong>有线网络传输速度稳定在100MB/s</strong>，<strong>WiFi传输峰值在60MB/s</strong>，WiFi偶尔掉速，随后需要升级全屋2.5G或万兆(包括路由器，交换机和网线)，WiFi升级为WiFi6，传输速度才会有进一步提升了。</p><h2 id=服务端软件>服务端软件</h2><h3 id=git>Git</h3><p>一般server自带Git，也可以使用如下命令安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install git
</span></span></code></pre></td></tr></table></div></div><p>Git本地配置<code>～/.gitconfig</code>参考如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[https]</span>
</span></span><span class=line><span class=cl><span class=na>proxy</span> <span class=o>=</span> <span class=s>http://127.0.0.1:7890/</span>
</span></span><span class=line><span class=cl><span class=na>postBuffer</span> <span class=o>=</span> <span class=s>1048576000</span>
</span></span><span class=line><span class=cl><span class=na>lowSpeedLimit</span> <span class=o>=</span> <span class=s>0</span>
</span></span><span class=line><span class=cl><span class=na>lowSpeedTime</span> <span class=o>=</span> <span class=s>999999</span>
</span></span><span class=line><span class=cl><span class=k>[http]</span>
</span></span><span class=line><span class=cl><span class=na>proxy</span> <span class=o>=</span> <span class=s>http://127.0.0.1:7890/</span>
</span></span><span class=line><span class=cl><span class=na>postBuffer</span> <span class=o>=</span> <span class=s>1048576000</span>
</span></span><span class=line><span class=cl><span class=na>lowSpeedLimit</span> <span class=o>=</span> <span class=s>0</span>
</span></span><span class=line><span class=cl><span class=na>lowSpeedTime</span> <span class=o>=</span> <span class=s>999999</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=wget>wget</h3><p>wget命令一般是系统自带，这里介绍一下使用代理服务器的方式。</p><p>首先修改wget环境变量：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim ~/.wgetrc
</span></span></code></pre></td></tr></table></div></div><p>增加如下配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>You<span class=o>](</span>/tags/You<span class=o>)</span> can <span class=nb>set</span> the default proxies <span class=k>for</span> Wget to use <span class=k>for</span> http, https, and ftp.
</span></span><span class=line><span class=cl><span class=c1># They will override the value in the environment.</span>
</span></span><span class=line><span class=cl><span class=nv>https_proxy</span> <span class=o>=</span> http://127.0.0.1:7890/
</span></span><span class=line><span class=cl><span class=nv>http_proxy</span> <span class=o>=</span> http://127.0.0.1:7890/
</span></span><span class=line><span class=cl><span class=nv>ftp_proxy</span> <span class=o>=</span> http://127.0.0.1:7890/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># If you do not want to use proxy at all, set this to off.</span>
</span></span><span class=line><span class=cl><span class=c1># If you want to use proxy at all, set this to on.</span>
</span></span><span class=line><span class=cl><span class=nv>use_proxy</span> <span class=o>=</span> off
</span></span></code></pre></td></tr></table></div></div><p>随后通过如下方式使用wget：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 不使用代理，默认不使用</span>
</span></span><span class=line><span class=cl>wget https://github.com/aria2/aria2/releases/download/release-1.36.0/aria2-1.36.0.tar.gz
</span></span><span class=line><span class=cl><span class=c1># 使用代理</span>
</span></span><span class=line><span class=cl>wget -Y on https://github.com/aria2/aria2/releases/download/release-1.36.0/aria2-1.36.0.tar.gz
</span></span></code></pre></td></tr></table></div></div><h3 id=nginx>Nginx</h3><p>虽然NAS是本地服务器，但是不可避免会代理一些静态资源，或者转发一些http服务，所以Nginx也是NAS必备。</p><p>安装非常简单：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install nginx
</span></span></code></pre></td></tr></table></div></div><p>安装完开始监听80端口，也可以进入配置项修改端口，增加代理资源等等。</p><h3 id=aria2>aria2</h3><p><a class=link href=http://aria2.github.io/ target=_blank rel=noopener>aria2</a>是一个非常强大的下载工具，支持多种下载协议，常见的HTTP/HTTPS，BT，FTP等等。</p><h4 id=安装>安装</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install -y aria2
</span></span><span class=line><span class=cl><span class=c1># 卸载</span>
</span></span><span class=line><span class=cl>sudo apt purge --autoremove -y aria2
</span></span></code></pre></td></tr></table></div></div><h4 id=配置>配置</h4><p>aria2有很多复杂的配置项，默认情况下，体验不是很好，比如重启任务丢失，BT下载慢等等。可以参考<a class=link href=https://github.com/P3TERX/aria2.conf target=_blank rel=noopener>aria2.conf</a>这个项目，是一个好的配置参考来源。</p><p>当然可以根据实际情况调整，修改后的配置如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1>## 文件保存设置 ##</span>
</span></span><span class=line><span class=cl><span class=c1># 下载目录。可使用绝对路径或相对路径, 默认: 当前启动位置</span>
</span></span><span class=line><span class=cl><span class=na>dir</span><span class=o>=</span><span class=s>/data1/downloads</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 磁盘缓存, 0 为禁用缓存，默认:16M</span>
</span></span><span class=line><span class=cl><span class=c1># 磁盘缓存的作用是把下载的数据块临时存储在内存中，然后集中写入硬盘，以减少磁盘 I/O ，提升读写性能，延长硬盘寿命。</span>
</span></span><span class=line><span class=cl><span class=c1># 建议在有足够的内存空闲情况下适当增加，但不要超过剩余可用内存空间大小。</span>
</span></span><span class=line><span class=cl><span class=c1># 此项值仅决定上限，实际对内存的占用取决于网速(带宽)和设备性能等其它因素。</span>
</span></span><span class=line><span class=cl><span class=na>disk-cache</span><span class=o>=</span><span class=s>64M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 文件预分配方式, 可选：none, prealloc, trunc, falloc, 默认:prealloc</span>
</span></span><span class=line><span class=cl><span class=c1># 预分配对于机械硬盘可有效降低磁盘碎片、提升磁盘读写性能、延长磁盘寿命。</span>
</span></span><span class=line><span class=cl><span class=c1># 机械硬盘使用 ext4（具有扩展支持），btrfs，xfs 或 NTFS（仅 MinGW 编译版本）等文件系统建议设置为 falloc</span>
</span></span><span class=line><span class=cl><span class=c1># 若无法下载，提示 fallocate failed.cause：Operation not supported 则说明不支持，请设置为 none</span>
</span></span><span class=line><span class=cl><span class=c1># prealloc 分配速度慢, trunc 无实际作用，不推荐使用。</span>
</span></span><span class=line><span class=cl><span class=c1># 固态硬盘不需要预分配，只建议设置为 none ，否则可能会导致双倍文件大小的数据写入，从而影响寿命。</span>
</span></span><span class=line><span class=cl><span class=c1># file-allocation=none</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 文件预分配大小限制。小于此选项值大小的文件不预分配空间，单位 K 或 M，默认：5M</span>
</span></span><span class=line><span class=cl><span class=na>no-file-allocation-limit</span><span class=o>=</span><span class=s>64M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 断点续传</span>
</span></span><span class=line><span class=cl><span class=na>continue</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 始终尝试断点续传，无法断点续传则终止下载，默认：true</span>
</span></span><span class=line><span class=cl><span class=na>always-resume</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 不支持断点续传的 URI 数值，当 always-resume=false 时生效。</span>
</span></span><span class=line><span class=cl><span class=c1># 达到这个数值从将头开始下载，值为 0 时所有 URI 不支持断点续传时才从头开始下载。</span>
</span></span><span class=line><span class=cl><span class=na>max-resume-failure-tries</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 获取服务器文件时间，默认:false</span>
</span></span><span class=line><span class=cl><span class=na>remote-time</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 进度保存设置 ##</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 从会话文件中读取下载任务</span>
</span></span><span class=line><span class=cl><span class=na>input-file</span><span class=o>=</span><span class=s>/home/ubuntu/.aria2/aria2.session</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 会话文件保存路径</span>
</span></span><span class=line><span class=cl><span class=c1># Aria2 退出时或指定的时间间隔会保存`错误/未完成`的下载任务到会话文件</span>
</span></span><span class=line><span class=cl><span class=na>save-session</span><span class=o>=</span><span class=s>/home/ubuntu/.aria2/aria2.session</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 任务状态改变后保存会话的间隔时间（秒）, 0 为仅在进程正常退出时保存, 默认:0</span>
</span></span><span class=line><span class=cl><span class=c1># 为了及时保存任务状态、防止任务丢失，此项值只建议设置为 1</span>
</span></span><span class=line><span class=cl><span class=na>save-session-interval</span><span class=o>=</span><span class=s>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自动保存任务进度到控制文件(*.aria2)的间隔时间（秒），0 为仅在进程正常退出时保存，默认：60</span>
</span></span><span class=line><span class=cl><span class=c1># 此项值也会间接影响从内存中把缓存的数据写入磁盘的频率</span>
</span></span><span class=line><span class=cl><span class=c1># 想降低磁盘 IOPS (每秒读写次数)则提高间隔时间</span>
</span></span><span class=line><span class=cl><span class=c1># 想在意外非正常退出时尽量保存更多的下载进度则降低间隔时间</span>
</span></span><span class=line><span class=cl><span class=c1># 非正常退出：进程崩溃、系统崩溃、SIGKILL 信号、设备断电等</span>
</span></span><span class=line><span class=cl><span class=na>auto-save-interval</span><span class=o>=</span><span class=s>20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 强制保存，即使任务已完成也保存信息到会话文件, 默认:false</span>
</span></span><span class=line><span class=cl><span class=c1># 开启后会在任务完成后保留 .aria2 文件，文件被移除且任务存在的情况下重启后会重新下载。</span>
</span></span><span class=line><span class=cl><span class=c1># 关闭后已完成的任务列表会在重启后清空。</span>
</span></span><span class=line><span class=cl><span class=na>force-save</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 下载连接设置 ##</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 文件未找到重试次数，默认:0 (禁用)</span>
</span></span><span class=line><span class=cl><span class=c1># 重试时同时会记录重试次数，所以也需要设置 max-tries 这个选项</span>
</span></span><span class=line><span class=cl><span class=na>max-file-not-found</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 最大尝试次数，0 表示无限，默认:5</span>
</span></span><span class=line><span class=cl><span class=na>max-tries</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重试等待时间（秒）, 默认:0 (禁用)</span>
</span></span><span class=line><span class=cl><span class=na>retry-wait</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 连接超时时间（秒）。默认：60</span>
</span></span><span class=line><span class=cl><span class=na>connect-timeout</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 超时时间（秒）。默认：60</span>
</span></span><span class=line><span class=cl><span class=na>timeout</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 最大同时下载任务数, 运行时可修改, 默认:5</span>
</span></span><span class=line><span class=cl><span class=na>max-concurrent-downloads</span><span class=o>=</span><span class=s>20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 单服务器最大连接线程数, 任务添加时可指定, 默认:1</span>
</span></span><span class=line><span class=cl><span class=c1># 最大值为 16 (增强版无限制), 且受限于单任务最大连接线程数(split)所设定的值。</span>
</span></span><span class=line><span class=cl><span class=na>max-connection-per-server</span><span class=o>=</span><span class=s>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 单任务最大连接线程数, 任务添加时可指定, 默认:5</span>
</span></span><span class=line><span class=cl><span class=na>split</span><span class=o>=</span><span class=s>64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 文件最小分段大小, 添加时可指定, 取值范围 1M-1024M (增强版最小值为 1K), 默认:20M</span>
</span></span><span class=line><span class=cl><span class=c1># 比如此项值为 10M, 当文件为 20MB 会分成两段并使用两个来源下载, 文件为 15MB 则只使用一个来源下载。</span>
</span></span><span class=line><span class=cl><span class=c1># 理论上值越小使用下载分段就越多，所能获得的实际线程数就越大，下载速度就越快，但受限于所下载文件服务器的策略。</span>
</span></span><span class=line><span class=cl><span class=na>min-split-size</span><span class=o>=</span><span class=s>4M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># HTTP/FTP 下载分片大小，所有分割都必须是此项值的倍数，最小值为 1M (增强版为 1K)，默认：1M</span>
</span></span><span class=line><span class=cl><span class=na>piece-length</span><span class=o>=</span><span class=s>1M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 允许分片大小变化。默认：false</span>
</span></span><span class=line><span class=cl><span class=c1># false：当分片大小与控制文件中的不同时将会中止下载</span>
</span></span><span class=line><span class=cl><span class=c1># true：丢失部分下载进度继续下载</span>
</span></span><span class=line><span class=cl><span class=na>allow-piece-length-change</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 最低下载速度限制。当下载速度低于或等于此选项的值时关闭连接（增强版本为重连），此选项与 BT 下载无关。单位 K 或 M ，默认：0 (无限制)</span>
</span></span><span class=line><span class=cl><span class=na>lowest-speed-limit</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 全局最大下载速度限制, 运行时可修改, 默认：0 (无限制)</span>
</span></span><span class=line><span class=cl><span class=na>max-overall-download-limit</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 单任务下载速度限制, 默认：0 (无限制)</span>
</span></span><span class=line><span class=cl><span class=na>max-download-limit</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 禁用 IPv6, 默认:false</span>
</span></span><span class=line><span class=cl><span class=na>disable-ipv6</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># GZip 支持，默认:false</span>
</span></span><span class=line><span class=cl><span class=na>http-accept-gzip</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># URI 复用，默认: true</span>
</span></span><span class=line><span class=cl><span class=na>reuse-uri</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 禁用 netrc 支持，默认:false</span>
</span></span><span class=line><span class=cl><span class=na>no-netrc</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 允许覆盖，当相关控制文件(.aria2)不存在时从头开始重新下载。默认:false</span>
</span></span><span class=line><span class=cl><span class=na>allow-overwrite</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 文件自动重命名，此选项仅在 HTTP(S)/FTP 下载中有效。新文件名在名称之后扩展名之前加上一个点和一个数字（1..9999）。默认:true</span>
</span></span><span class=line><span class=cl><span class=na>auto-file-renaming</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 UTF-8 处理 Content-Disposition ，默认:false</span>
</span></span><span class=line><span class=cl><span class=na>content-disposition-default-utf8</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 最低 TLS 版本，可选：TLSv1.1、TLSv1.2、TLSv1.3 默认:TLSv1.2</span>
</span></span><span class=line><span class=cl><span class=c1>#min-tls-version=TLSv1.2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## BT/PT 下载设置 ##</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT 监听端口(TCP), 默认:6881-6999</span>
</span></span><span class=line><span class=cl><span class=c1># 直通外网的设备，比如 VPS ，务必配置防火墙和安全组策略允许此端口入站</span>
</span></span><span class=line><span class=cl><span class=c1># 内网环境的设备，比如 NAS ，除了防火墙设置，还需在路由器设置外网端口转发到此端口</span>
</span></span><span class=line><span class=cl><span class=na>listen-port</span><span class=o>=</span><span class=s>51413</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># DHT 网络与 UDP tracker 监听端口(UDP), 默认:6881-6999</span>
</span></span><span class=line><span class=cl><span class=c1># 因协议不同，可以与 BT 监听端口使用相同的端口，方便配置防火墙和端口转发策略。</span>
</span></span><span class=line><span class=cl><span class=na>dht-listen-port</span><span class=o>=</span><span class=s>51413</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启用 IPv4 DHT 功能, PT 下载(私有种子)会自动禁用, 默认:true</span>
</span></span><span class=line><span class=cl><span class=na>enable-dht</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启用 IPv6 DHT 功能, PT 下载(私有种子)会自动禁用，默认:false</span>
</span></span><span class=line><span class=cl><span class=c1># 在没有 IPv6 支持的环境开启可能会导致 DHT 功能异常</span>
</span></span><span class=line><span class=cl><span class=na>enable-dht6</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定 BT 和 DHT 网络中的 IP 地址</span>
</span></span><span class=line><span class=cl><span class=c1># 使用场景：在家庭宽带没有公网 IP 的情况下可以把 BT 和 DHT 监听端口转发至具有公网 IP 的服务器，在此填写服务器的 IP ，可以提升 BT 下载速率。</span>
</span></span><span class=line><span class=cl><span class=c1>#bt-external-ip=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IPv4 DHT 文件路径，默认：$HOME/.aria2/dht.dat</span>
</span></span><span class=line><span class=cl><span class=na>dht-file-path</span><span class=o>=</span><span class=s>/home/ubuntu/.aria2/dht.dat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IPv6 DHT 文件路径，默认：$HOME/.aria2/dht6.dat</span>
</span></span><span class=line><span class=cl><span class=na>dht-file-path6</span><span class=o>=</span><span class=s>/home/ubuntu/.aria2/dht6.dat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IPv4 DHT 网络引导节点</span>
</span></span><span class=line><span class=cl><span class=na>dht-entry-point</span><span class=o>=</span><span class=s>dht.transmissionbt.com:6881</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># IPv6 DHT 网络引导节点</span>
</span></span><span class=line><span class=cl><span class=na>dht-entry-point6</span><span class=o>=</span><span class=s>dht.transmissionbt.com:6881</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 本地节点发现, PT 下载(私有种子)会自动禁用 默认:false</span>
</span></span><span class=line><span class=cl><span class=na>bt-enable-lpd</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定用于本地节点发现的接口，可能的值：接口，IP地址</span>
</span></span><span class=line><span class=cl><span class=c1># 如果未指定此选项，则选择默认接口。</span>
</span></span><span class=line><span class=cl><span class=c1>#bt-lpd-interface=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启用节点交换, PT 下载(私有种子)会自动禁用, 默认:true</span>
</span></span><span class=line><span class=cl><span class=na>enable-peer-exchange</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT 下载最大连接数（单任务），运行时可修改。0 为不限制，默认:55</span>
</span></span><span class=line><span class=cl><span class=c1># 理想情况下连接数越多下载越快，但在实际情况是只有少部分连接到的做种者上传速度快，其余的上传慢或者不上传。</span>
</span></span><span class=line><span class=cl><span class=c1># 如果不限制，当下载非常热门的种子或任务数非常多时可能会因连接数过多导致进程崩溃或网络阻塞。</span>
</span></span><span class=line><span class=cl><span class=c1># 进程崩溃：如果设备 CPU 性能一般，连接数过多导致 CPU 占用过高，因资源不足 Aria2 进程会强制被终结。</span>
</span></span><span class=line><span class=cl><span class=c1># 网络阻塞：在内网环境下，即使下载没有占满带宽也会导致其它设备无法正常上网。因远古低性能路由器的转发性能瓶颈导致。</span>
</span></span><span class=line><span class=cl><span class=na>bt-max-peers</span><span class=o>=</span><span class=s>128</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT 下载期望速度值（单任务），运行时可修改。单位 K 或 M 。默认:50K</span>
</span></span><span class=line><span class=cl><span class=c1># BT 下载速度低于此选项值时会临时提高连接数来获得更快的下载速度，不过前提是有更多的做种者可供连接。</span>
</span></span><span class=line><span class=cl><span class=c1># 实测临时提高连接数没有上限，但不会像不做限制一样无限增加，会根据算法进行合理的动态调节。</span>
</span></span><span class=line><span class=cl><span class=na>bt-request-peer-speed-limit</span><span class=o>=</span><span class=s>10M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 全局最大上传速度限制, 运行时可修改, 默认:0 (无限制)</span>
</span></span><span class=line><span class=cl><span class=c1># 设置过低可能影响 BT 下载速度</span>
</span></span><span class=line><span class=cl><span class=na>max-overall-upload-limit</span><span class=o>=</span><span class=s>2M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 单任务上传速度限制, 默认:0 (无限制)</span>
</span></span><span class=line><span class=cl><span class=na>max-upload-limit</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 最小分享率。当种子的分享率达到此选项设置的值时停止做种, 0 为一直做种, 默认:1.0</span>
</span></span><span class=line><span class=cl><span class=c1># 强烈建议您将此选项设置为大于等于 1.0</span>
</span></span><span class=line><span class=cl><span class=na>seed-ratio</span><span class=o>=</span><span class=s>1.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 最小做种时间（分钟）。设置为 0 时将在 BT 任务下载完成后停止做种。</span>
</span></span><span class=line><span class=cl><span class=na>seed-time</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 做种前检查文件哈希, 默认:true</span>
</span></span><span class=line><span class=cl><span class=na>bt-hash-check-seed</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 继续之前的BT任务时, 无需再次校验, 默认:false</span>
</span></span><span class=line><span class=cl><span class=na>bt-seed-unverified</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT tracker 服务器连接超时时间（秒）。默认：60</span>
</span></span><span class=line><span class=cl><span class=c1># 建立连接后，此选项无效，将使用 bt-tracker-timeout 选项的值</span>
</span></span><span class=line><span class=cl><span class=na>bt-tracker-connect-timeout</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT tracker 服务器超时时间（秒）。默认：60</span>
</span></span><span class=line><span class=cl><span class=na>bt-tracker-timeout</span><span class=o>=</span><span class=s>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT 服务器连接间隔时间（秒）。默认：0 (自动)</span>
</span></span><span class=line><span class=cl><span class=c1>#bt-tracker-interval=0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT 下载优先下载文件开头或结尾</span>
</span></span><span class=line><span class=cl><span class=na>bt-prioritize-piece</span><span class=o>=</span><span class=s>head=32M,tail=32M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 保存通过 WebUI(RPC) 上传的种子文件(.torrent)，默认:true</span>
</span></span><span class=line><span class=cl><span class=c1># 所有涉及种子文件保存的选项都建议开启，不保存种子文件有任务丢失的风险。</span>
</span></span><span class=line><span class=cl><span class=c1># 通过 RPC 自定义临时下载目录可能不会保存种子文件。</span>
</span></span><span class=line><span class=cl><span class=na>rpc-save-upload-metadata</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 下载种子文件(.torrent)自动开始下载, 默认:true，可选：false|mem</span>
</span></span><span class=line><span class=cl><span class=c1># true：保存种子文件</span>
</span></span><span class=line><span class=cl><span class=c1># false：仅下载种子文件</span>
</span></span><span class=line><span class=cl><span class=c1># mem：将种子保存在内存中</span>
</span></span><span class=line><span class=cl><span class=na>follow-torrent</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 种子文件下载完后暂停任务，默认：false</span>
</span></span><span class=line><span class=cl><span class=c1># 在开启 follow-torrent 选项后下载种子文件或磁力会自动开始下载任务进行下载，而同时开启当此选项后会建立相关任务并暂停。</span>
</span></span><span class=line><span class=cl><span class=na>pause-metadata</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 保存磁力链接元数据为种子文件(.torrent), 默认:false</span>
</span></span><span class=line><span class=cl><span class=na>bt-save-metadata</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 加载已保存的元数据文件(.torrent)，默认:false</span>
</span></span><span class=line><span class=cl><span class=na>bt-load-saved-metadata</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 删除 BT 下载任务中未选择文件，默认:false</span>
</span></span><span class=line><span class=cl><span class=na>bt-remove-unselected-file</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT强制加密, 默认: false</span>
</span></span><span class=line><span class=cl><span class=c1># 启用后将拒绝旧的 BT 握手协议并仅使用混淆握手及加密。可以解决部分运营商对 BT 下载的封锁，且有一定的防版权投诉与迅雷吸血效果。</span>
</span></span><span class=line><span class=cl><span class=c1># 此选项相当于后面两个选项(bt-require-crypto=true, bt-min-crypto-level=arc4)的快捷开启方式，但不会修改这两个选项的值。</span>
</span></span><span class=line><span class=cl><span class=na>bt-force-encryption</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT加密需求，默认：false</span>
</span></span><span class=line><span class=cl><span class=c1># 启用后拒绝与旧的 BitTorrent 握手协议(\19BitTorrent protocol)建立连接，始终使用混淆处理握手。</span>
</span></span><span class=line><span class=cl><span class=c1>#bt-require-crypto=true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT最低加密等级，可选：plain（明文），arc4（加密），默认：plain</span>
</span></span><span class=line><span class=cl><span class=c1>#bt-min-crypto-level=arc4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 分离仅做种任务，默认：false</span>
</span></span><span class=line><span class=cl><span class=c1># 从正在下载的任务中排除已经下载完成且正在做种的任务，并开始等待列表中的下一个任务。</span>
</span></span><span class=line><span class=cl><span class=na>bt-detach-seed-only</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 客户端伪装 ##</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自定义 User Agent</span>
</span></span><span class=line><span class=cl><span class=na>user-agent</span><span class=o>=</span><span class=s>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36 Edg/93.0.961.47</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT 客户端伪装</span>
</span></span><span class=line><span class=cl><span class=c1># PT 下载需要保持 user-agent 和 peer-agent 两个参数一致</span>
</span></span><span class=line><span class=cl><span class=c1># 部分 PT 站对 Aria2 有特殊封禁机制，客户端伪装不一定有效，且有封禁账号的风险。</span>
</span></span><span class=line><span class=cl><span class=c1>#user-agent=Deluge 1.3.15</span>
</span></span><span class=line><span class=cl><span class=na>peer-agent</span><span class=o>=</span><span class=s>Deluge 1.3.15</span>
</span></span><span class=line><span class=cl><span class=na>peer-id-prefix</span><span class=o>=</span><span class=s>-DE13F0-</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 执行额外命令 ##</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 下载停止后执行的命令</span>
</span></span><span class=line><span class=cl><span class=c1># 从 正在下载 到 删除、错误、完成 时触发。暂停被标记为未开始下载，故与此项无关。</span>
</span></span><span class=line><span class=cl><span class=c1>#on-download-stop=/home/ubuntu/.aria2/delete.sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 下载完成后执行的命令</span>
</span></span><span class=line><span class=cl><span class=c1># 此项未定义则执行 下载停止后执行的命令 (on-download-stop)</span>
</span></span><span class=line><span class=cl><span class=c1>#on-download-complete=/home/ubuntu/.aria2/clean.sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 下载错误后执行的命令</span>
</span></span><span class=line><span class=cl><span class=c1># 此项未定义则执行 下载停止后执行的命令 (on-download-stop)</span>
</span></span><span class=line><span class=cl><span class=c1>#on-download-error=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 下载暂停后执行的命令</span>
</span></span><span class=line><span class=cl><span class=c1>#on-download-pause=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 下载开始后执行的命令</span>
</span></span><span class=line><span class=cl><span class=c1>#on-download-start=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># BT 下载完成后执行的命令</span>
</span></span><span class=line><span class=cl><span class=c1>#on-bt-download-complete=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## RPC 设置 ##</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启用 JSON-RPC/XML-RPC 服务器, 默认:false</span>
</span></span><span class=line><span class=cl><span class=na>enable-rpc</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 接受所有远程请求, 默认:false</span>
</span></span><span class=line><span class=cl><span class=na>rpc-allow-origin-all</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 允许外部访问, 默认:false</span>
</span></span><span class=line><span class=cl><span class=na>rpc-listen-all</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RPC 监听端口, 默认:6800</span>
</span></span><span class=line><span class=cl><span class=na>rpc-listen-port</span><span class=o>=</span><span class=s>6800</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RPC 密钥</span>
</span></span><span class=line><span class=cl><span class=na>rpc-secret</span><span class=o>=</span><span class=s>P3TERX</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RPC 最大请求大小</span>
</span></span><span class=line><span class=cl><span class=na>rpc-max-request-size</span><span class=o>=</span><span class=s>10M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RPC 服务 SSL/TLS 加密, 默认：false</span>
</span></span><span class=line><span class=cl><span class=c1># 启用加密后必须使用 https 或者 wss 协议连接</span>
</span></span><span class=line><span class=cl><span class=c1># 不推荐开启，建议使用 web server 反向代理，比如 Nginx、Caddy ，灵活性更强。</span>
</span></span><span class=line><span class=cl><span class=c1>#rpc-secure=false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在 RPC 服务中启用 SSL/TLS 加密时的证书文件(.pem/.crt)</span>
</span></span><span class=line><span class=cl><span class=c1>#rpc-certificate=/home/ubuntu/.aria2/xxx.pem</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在 RPC 服务中启用 SSL/TLS 加密时的私钥文件(.key)</span>
</span></span><span class=line><span class=cl><span class=c1>#rpc-private-key=/home/ubuntu/.aria2/xxx.key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 事件轮询方式, 可选：epoll, kqueue, port, poll, select, 不同系统默认值不同</span>
</span></span><span class=line><span class=cl><span class=c1>#event-poll=select</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 高级选项 ##</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启用异步 DNS 功能。默认：true</span>
</span></span><span class=line><span class=cl><span class=c1>#async-dns=true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定异步 DNS 服务器列表，未指定则从 /etc/resolv.conf 中读取。</span>
</span></span><span class=line><span class=cl><span class=c1>#async-dns-server=119.29.29.29,223.5.5.5,8.8.8.8,1.1.1.1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定单个网络接口，可能的值：接口，IP地址，主机名</span>
</span></span><span class=line><span class=cl><span class=c1># 如果接口具有多个 IP 地址，则建议指定 IP 地址。</span>
</span></span><span class=line><span class=cl><span class=c1># 已知指定网络接口会影响依赖本地 RPC 的连接的功能场景，即通过 localhost 和 127.0.0.1 无法与 Aria2 服务端进行讯通。</span>
</span></span><span class=line><span class=cl><span class=c1>#interface=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定多个网络接口，多个值之间使用逗号(,)分隔。</span>
</span></span><span class=line><span class=cl><span class=c1># 使用 interface 选项时会忽略此项。</span>
</span></span><span class=line><span class=cl><span class=c1>#multiple-interface=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 日志设置 ##</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 日志文件保存路径，忽略或设置为空为不保存，默认：不保存</span>
</span></span><span class=line><span class=cl><span class=c1>#log=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 日志级别，可选 debug, info, notice, warn, error 。默认：debug</span>
</span></span><span class=line><span class=cl><span class=c1>#log-level=warn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 控制台日志级别，可选 debug, info, notice, warn, error ，默认：notice</span>
</span></span><span class=line><span class=cl><span class=na>console-log-level</span><span class=o>=</span><span class=s>notice</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安静模式，禁止在控制台输出日志，默认：false</span>
</span></span><span class=line><span class=cl><span class=na>quiet</span><span class=o>=</span><span class=s>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 下载进度摘要输出间隔时间（秒），0 为禁止输出。默认：60</span>
</span></span><span class=line><span class=cl><span class=na>summary-interval</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## BitTorrent trackers ##</span>
</span></span><span class=line><span class=cl><span class=c1># bt-tracker=</span>
</span></span></code></pre></td></tr></table></div></div><p>将其保存在<code>$HOME/.aria2/aria2.conf</code>即可。另外需要将<a class=link href=https://github.com/P3TERX/aria2.conf target=_blank rel=noopener>aria2.conf</a>的<code>dht.dat</code>和<code>dht6.dat</code>保存到<code>$HOME/.aria2/</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget -Y on https://github.com/P3TERX/aria2.conf/raw/master/dht.dat
</span></span><span class=line><span class=cl>wget -Y on https://github.com/P3TERX/aria2.conf/raw/master/dht6.dat
</span></span><span class=line><span class=cl>touch aria2.session
</span></span></code></pre></td></tr></table></div></div><p>增加systemd配置<code>aria2.service</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>aria2 - The ultra fast download utility</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target nss-lookup.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>User</span><span class=o>=</span><span class=s>ubuntu</span>
</span></span><span class=line><span class=cl><span class=na>NoNewPrivileges</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>aria2c --conf-path= /home/ubuntu/.aria2/aria2.conf</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>10s</span>
</span></span><span class=line><span class=cl><span class=na>LimitNOFILE</span><span class=o>=</span><span class=s>infinity</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span></code></pre></td></tr></table></div></div><p>启动服务：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo cp aria2.service /etc/systemd/system
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> aria2.service
</span></span><span class=line><span class=cl>sudo systemctl start aria2.service
</span></span><span class=line><span class=cl>sudo systemctl status aria2.service
</span></span></code></pre></td></tr></table></div></div><h4 id=webui>WebUI</h4><p>强烈推荐使用WebUI来管理aria2的任务，因为很多任务下载耗时，多任务管理也更有优势。<a class=link href=https://github.com/mayswind/AriaNg target=_blank rel=noopener>AriaNg</a>是一个洁面简洁的管理面板，安装也很简单：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 下载资源</span>
</span></span><span class=line><span class=cl>wget -Y on https://github.com/mayswind/AriaNg/releases/download/1.3.6/AriaNg-1.3.6-AllInOne.zip
</span></span><span class=line><span class=cl>unzip AriaNg-1.3.6-AllInOne.zip
</span></span><span class=line><span class=cl><span class=c1># 直接复制到nginx的默认静态资源页面即可</span>
</span></span><span class=line><span class=cl>sudo mkdir /var/www/html/AriaNg
</span></span><span class=line><span class=cl>sudo cp index.html /var/www/html/AriaNg/
</span></span></code></pre></td></tr></table></div></div><p>好的，现在直接访问NAS服务即可，比如<code>http://192.168.31.3/AriaNg</code>。</p><p><img src=/assets/Pasted%20image%2020230614214332.png loading=lazy alt="Pasted image 20230614214332.png"></p><h5 id=未认证unauthorized>未认证/Unauthorized</h5><p>这是因为你没有输入正确aria2的RPC密码，该密码通过配置项<code>rpc-secret</code>修改。AriaNg可以在<code>AriaNg设置->RPC</code>处修改，如图：</p><p><img src=/assets/Pasted%20image%2020230614215046.png loading=lazy alt="Pasted image 20230614215046.png"></p><h3 id=samba>Samba</h3><p>NAS上Samba必备，用于Mac，window访问你的服务器文件系统，共建资料，备份数据等。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 安装samba服务器</span>
</span></span><span class=line><span class=cl>sudo apt-get install samba samba-common
</span></span><span class=line><span class=cl><span class=c1># 创建一个用于分享的samba目录</span>
</span></span><span class=line><span class=cl>sudo mkdir /home/ubuntu/share
</span></span><span class=line><span class=cl><span class=c1># donot forgot to add user to samba&#39;s database</span>
</span></span><span class=line><span class=cl>sudo smbpasswd -a ubuntu
</span></span><span class=line><span class=cl><span class=c1># 配置samba的配置文件, 确保共享的文件夹该用户有权限即可</span>
</span></span><span class=line><span class=cl>sudo vim /etc/samba/smb.conf
</span></span><span class=line><span class=cl><span class=c1># 重启samba服务器</span>
</span></span><span class=line><span class=cl>sudo service smbd restart
</span></span></code></pre></td></tr></table></div></div><p>配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[data1]</span>
</span></span><span class=line><span class=cl><span class=na>comment</span> <span class=o>=</span> <span class=s>share folder</span>
</span></span><span class=line><span class=cl><span class=na>browseable</span> <span class=o>=</span> <span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>path</span> <span class=o>=</span> <span class=s>/data1</span>
</span></span><span class=line><span class=cl><span class=na>create mask</span> <span class=o>=</span> <span class=s>0777</span>
</span></span><span class=line><span class=cl><span class=na>directory mask</span> <span class=o>=</span> <span class=s>0777</span>
</span></span><span class=line><span class=cl><span class=na>valid users</span> <span class=o>=</span> <span class=s>ghome</span>
</span></span><span class=line><span class=cl><span class=na>force user</span> <span class=o>=</span> <span class=s>ghome</span>
</span></span><span class=line><span class=cl><span class=na>force group</span> <span class=o>=</span> <span class=s>ghome</span>
</span></span><span class=line><span class=cl><span class=na>public</span> <span class=o>=</span> <span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>available</span> <span class=o>=</span> <span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>writable</span> <span class=o>=</span> <span class=s>yes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[data2]</span>
</span></span><span class=line><span class=cl><span class=na>comment</span> <span class=o>=</span> <span class=s>share folder</span>
</span></span><span class=line><span class=cl><span class=na>browseable</span> <span class=o>=</span> <span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>path</span> <span class=o>=</span> <span class=s>/data2</span>
</span></span><span class=line><span class=cl><span class=na>create mask</span> <span class=o>=</span> <span class=s>0777</span>
</span></span><span class=line><span class=cl><span class=na>directory mask</span> <span class=o>=</span> <span class=s>0777</span>
</span></span><span class=line><span class=cl><span class=na>valid users</span> <span class=o>=</span> <span class=s>ghome</span>
</span></span><span class=line><span class=cl><span class=na>force user</span> <span class=o>=</span> <span class=s>ghome</span>
</span></span><span class=line><span class=cl><span class=na>force group</span> <span class=o>=</span> <span class=s>ghome</span>
</span></span><span class=line><span class=cl><span class=na>public</span> <span class=o>=</span> <span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>available</span> <span class=o>=</span> <span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>writable</span> <span class=o>=</span> <span class=s>yes</span>
</span></span></code></pre></td></tr></table></div></div><p>一些资料：</p><ul><li><code>如何正确使用Samba</code></li><li><a class=link href=https://github.com/samba-team/samba target=_blank rel=noopener>https://github.com/samba-team/samba</a></li><li><a class=link href=https://wiki.samba.org/index.php/FAQ target=_blank rel=noopener>https://wiki.samba.org/index.php/FAQ</a></li><li><a class=link href=https://wiki.samba.org/index.php/User_Documentation target=_blank rel=noopener>https://wiki.samba.org/index.php/User_Documentation</a></li><li><a class=link href=https://www.linuxidc.com/Linux/2018-11/155466.htm target=_blank rel=noopener>https://www.linuxidc.com/Linux/2018-11/155466.htm</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/devops/>DevOps</a>
<a href=/tags/nas/>NAS</a>
<a href=/tags/nuc12/>NUC12</a>
<a href=/tags/linux/>linux</a>
<a href=/tags/%E8%B6%A3%E7%8E%A9/>趣玩</a>
<a href=/tags/you/>You</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/blog/devops/nas%E6%8A%98%E8%85%BE%E8%AE%B0/><div class=article-image><img src=/assets/alex-cheung-gQdPafWDSyk-unsplash.jpg loading=lazy data-key data-hash=/assets/alex-cheung-gQdPafWDSyk-unsplash.jpg></div><div class=article-details><h2 class=article-title>NAS折腾记</h2></div></a></article><article class=has-image><a href=/blog/devops/%E4%BD%BF%E7%94%A8cloudflare-pages%E6%89%98%E7%AE%A1%E7%BD%91%E7%AB%99/><div class=article-image><img src=/assets/Pasted%20image%2020230703224931.png loading=lazy data-key data-hash=/assets/Pasted%20image%2020230703224931.png></div><div class=article-details><h2 class=article-title>使用CloudFlare Pages托管网站</h2></div></a></article><article class=has-image><a href=/blog/misc/%E6%90%AD%E5%BB%BAchatgpt%E4%B8%8Eautogpt/><div class=article-image><img src=/assets/ilgmyzin-agFmImWyPso-unsplash.jpg loading=lazy data-key data-hash=/assets/ilgmyzin-agFmImWyPso-unsplash.jpg></div><div class=article-details><h2 class=article-title>搭建ChatGPT与AutoGPT</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=GalaIO/galaio.github.io data-repo-id=R_kgDOJwojrg data-category=General data-category-id=DIC_kwDOJwojrs4CXSBu data-mapping=title data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN crossorigin=anonymous async></script>
<script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2023 攻城狮Gala</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>